<!-- Index.cshtml -->

@{
    ViewBag.Title = "Scanner Demo";
}

<!DOCTYPE html>
<html>
<head>
    <title>Scanner Demo</title>
    <script src="https://cdn.dynamsoft.com/dwt/15.2/dynamsoft.webtwain.min.js"></script>
</head>
<body>
    <button onclick="scanAndUpload()">Scan and Upload</button>

    <script>function scanAndUpload() {
            Dynamsoft.WebTwainEnv.Load();

            Dynamsoft.WebTwainEnv.RegisterEvent('OnWebTwainReady', function () {
                var dwObject = Dynamsoft.WebTwainEnv.GetWebTwain('dwtcontrolContainer');
                dwObject.IfShowUI = true;
                dwObject.SelectSource();
                dwObject.OpenSource();
                dwObject.AcquireImage();

                // After acquiring the image, send it to the server
                var imageData = dwObject.GetSelectedImages(0);
                uploadScannedImage(imageData);
            });
        }

        function uploadScannedImage(imageData) {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/Scanner/UploadScannedImage', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    console.log('Scanned image uploaded successfully.');
                }
            };
            xhr.send(JSON.stringify({ scannedImage: imageData }));
        }</script>

    <div id="dwtcontrolContainer"></div>
</body>
</html>
